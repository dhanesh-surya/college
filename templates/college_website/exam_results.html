{% extends 'base.html' %}
{% load static %}

{% block title %}Exam Results - {{ college_info.college_name }}{% endblock %}

{% block content %}
<!-- Header Section -->
<section class="hero-section tw-bg-gradient-to-r tw-from-red-600 tw-to-red-800 tw-py-16">
    <div class="container">
        <div class="row tw-justify-center text-center">
            <div class="col-lg-8">
                <h1 class="tw-text-4xl tw-font-bold tw-text-white tw-mb-4">Exam Results</h1>
                <p class="tw-text-xl tw-text-red-100 tw-mb-6">Check your academic performance and examination results</p>
                <div class="tw-flex tw-flex-wrap tw-justify-center tw-gap-3">
                    <div class="tw-bg-white tw-bg-opacity-20 tw-rounded-full tw-px-4 tw-py-2">
                        <i class="fas fa-graduation-cap tw-text-white tw-mr-2"></i>
                        <span class="tw-text-white tw-font-medium">Academic Excellence</span>
                    </div>
                    <div class="tw-bg-white tw-bg-opacity-20 tw-rounded-full tw-px-4 tw-py-2">
                        <i class="fas fa-chart-line tw-text-white tw-mr-2"></i>
                        <span class="tw-text-white tw-font-medium">Performance Tracking</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Filter Section -->
<section class="filter-section tw-py-8 tw-bg-gray-50">
    <div class="container">
        <div class="row tw-justify-center">
            <div class="col-lg-10">
                <div class="tw-bg-white tw-rounded-xl tw-shadow-lg tw-p-6">
                    <h3 class="tw-text-xl tw-font-semibold tw-text-gray-800 tw-mb-4">Filter Results</h3>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label tw-font-medium tw-text-gray-700">Result Type</label>
                            <select class="form-select" id="resultTypeFilter">
                                <option value="">All Types</option>
                                <option value="semester">Semester Exam</option>
                                <option value="annual">Annual Exam</option>
                                <option value="entrance">Entrance Exam</option>
                                <option value="supplementary">Supplementary Exam</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label tw-font-medium tw-text-gray-700">Year</label>
                            <select class="form-select" id="yearFilter">
                                <option value="">All Years</option>
                                {% for result in results %}
                                    <option value="{{ result.result_date.year }}">{{ result.result_date.year }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label tw-font-medium tw-text-gray-700">Sort By</label>
                            <select class="form-select" id="sortFilter">
                                <option value="date">Latest First</option>
                                <option value="title">Title A-Z</option>
                                <option value="type">Result Type</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Results Section -->
<section class="results-section tw-py-12">
    <div class="container">
        <div class="row tw-justify-center">
            <div class="col-lg-10">
                <div class="d-flex tw-justify-content-between tw-align-items-center tw-mb-6">
                    <h2 class="section-title tw-text-3xl tw-font-bold tw-text-gray-800">Available Results</h2>
                    <div class="tw-text-gray-600">
                        <i class="fas fa-info-circle tw-mr-2"></i>
                        <span id="resultsCount">{{ results|length }} results found</span>
                    </div>
                </div>

                {% if results %}
                    <div class="row g-4" id="resultsContainer">
                        {% for result in results %}
                        <div class="col-lg-6 mb-4 result-item" 
                             data-type="{{ result.result_type }}" 
                             data-year="{{ result.result_date.year }}">
                            <div class="card h-100 border-0 shadow-sm result-card">
                                <div class="card-body tw-p-6">
                                    <div class="d-flex tw-justify-content-between tw-align-items-start tw-mb-3">
                                        <span class="badge bg-{{ result.result_type|default:'primary' }} tw-px-3 tw-py-2 tw-text-sm">
                                            {% if result.result_type == 'semester' %}
                                                <i class="fas fa-calendar-alt tw-mr-2"></i>Semester
                                            {% elif result.result_type == 'annual' %}
                                                <i class="fas fa-calendar-check tw-mr-2"></i>Annual
                                            {% elif result.result_type == 'entrance' %}
                                                <i class="fas fa-sign-in-alt tw-mr-2"></i>Entrance
                                            {% elif result.result_type == 'supplementary' %}
                                                <i class="fas fa-redo tw-mr-2"></i>Supplementary
                                            {% else %}
                                                <i class="fas fa-file-alt tw-mr-2"></i>{{ result.get_result_type_display }}
                                            {% endif %}
                                        </span>
                                        <small class="text-muted">
                                            <i class="fas fa-calendar tw-mr-1"></i>{{ result.result_date|date:"M d, Y" }}
                                        </small>
                                    </div>
                                    
                                    <h5 class="card-title tw-text-xl tw-font-semibold tw-text-gray-800 tw-mb-3">
                                        {{ result.title }}
                                    </h5>
                                    
                                    {% if result.description %}
                                    <p class="card-text tw-text-gray-600 tw-mb-4">
                                        {{ result.description|striptags|truncatewords:25 }}
                                    </p>
                                    {% endif %}
                                    
                                    <div class="tw-flex tw-flex-wrap tw-gap-2 tw-mb-4">
                                        <div class="tw-bg-gray-100 tw-rounded-full tw-px-3 tw-py-1 tw-text-sm tw-text-gray-700">
                                            <i class="fas fa-calendar-day tw-mr-1"></i>
                                            Exam: {{ result.exam_date|date:"M d, Y" }}
                                        </div>
                                        {% if result.is_featured %}
                                        <div class="tw-bg-yellow-100 tw-rounded-full tw-px-3 tw-py-1 tw-text-sm tw-text-yellow-700">
                                            <i class="fas fa-star tw-mr-1"></i>Featured
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="tw-flex tw-flex-wrap tw-gap-2">
                                        {% if result.result_file %}
                                        <a href="{{ result.result_file.url }}" class="btn btn-primary btn-sm tw-rounded-full tw-px-4 tw-py-2" target="_blank">
                                            <i class="fas fa-download tw-mr-2"></i>Download Result
                                        </a>
                                        {% endif %}
                                        
                                        {% if result.result_link %}
                                        <a href="{{ result.result_link }}" class="btn btn-outline-primary btn-sm tw-rounded-full tw-px-4 tw-py-2" target="_blank">
                                            <i class="fas fa-external-link-alt tw-mr-2"></i>View Online
                                        </a>
                                        {% endif %}
                                        
                                        <a href="{% url 'college_website:result_detail' result.slug %}" class="btn btn-outline-secondary btn-sm tw-rounded-full tw-px-4 tw-py-2">
                                            <i class="fas fa-eye tw-mr-2"></i>View Details
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center tw-py-12">
                        <div class="tw-bg-gray-50 tw-rounded-xl tw-p-8">
                            <i class="fas fa-file-alt fa-4x text-muted tw-mb-4"></i>
                            <h4 class="text-muted tw-mb-3">No Results Available</h4>
                            <p class="text-muted tw-mb-4">Currently there are no published exam results. Please check back later.</p>
                            <div class="tw-flex tw-justify-center tw-gap-3">
                                <a href="{% url 'college_website:examinations' %}" class="btn btn-primary tw-rounded-full tw-px-6 tw-py-2">
                                    <i class="fas fa-arrow-left tw-mr-2"></i>Back to Examinations
                                </a>
                                <a href="{% url 'college_website:home' %}" class="btn btn-outline-primary tw-rounded-full tw-px-6 tw-py-2">
                                    <i class="fas fa-home tw-mr-2"></i>Go Home
                                </a>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Quick Links Section -->
<section class="quick-links-section tw-py-12 tw-bg-gray-50">
    <div class="container">
        <div class="row tw-justify-center">
            <div class="col-lg-10">
                <h3 class="tw-text-2xl tw-font-bold tw-text-gray-800 tw-mb-6 text-center">Related Resources</h3>
                <div class="row g-4">
                    <div class="col-md-4">
                        <a href="{% url 'college_website:exam_timetable' %}" class="tw-block tw-bg-white tw-rounded-xl tw-shadow-lg tw-p-6 tw-text-center tw-transition-all tw-duration-300 hover:tw-scale-105 hover:tw-shadow-xl">
                            <div class="tw-bg-blue-500 tw-w-16 tw-h-16 tw-rounded-full tw-flex tw-items-center tw-justify-center tw-mx-auto tw-mb-4">
                                <i class="fas fa-calendar-alt tw-text-white tw-text-2xl"></i>
                            </div>
                            <h4 class="tw-font-semibold tw-text-gray-800 tw-mb-2">Exam Timetable</h4>
                            <p class="tw-text-gray-600 tw-text-sm">View upcoming examination schedules</p>
                        </a>
                    </div>
                    <div class="col-md-4">
                        <a href="{% url 'college_website:question_papers' %}" class="tw-block tw-bg-white tw-rounded-xl tw-shadow-lg tw-p-6 tw-text-center tw-transition-all tw-duration-300 hover:tw-scale-105 hover:tw-shadow-xl">
                            <div class="tw-bg-green-500 tw-w-16 tw-h-16 tw-rounded-full tw-flex tw-items-center tw-justify-center tw-mx-auto tw-mb-4">
                                <i class="fas fa-file-alt tw-text-white tw-text-2xl"></i>
                            </div>
                            <h4 class="tw-font-semibold tw-text-gray-800 tw-mb-2">Question Papers</h4>
                            <p class="tw-text-gray-600 tw-text-sm">Access previous year question papers</p>
                        </a>
                    </div>
                    <div class="col-md-4">
                        <a href="{% url 'college_website:revaluation' %}" class="tw-block tw-bg-white tw-rounded-xl tw-shadow-lg tw-p-6 tw-text-center tw-transition-all tw-duration-300 hover:tw-scale-105 hover:tw-shadow-xl">
                            <div class="tw-bg-purple-500 tw-w-16 tw-h-16 tw-rounded-full tw-flex tw-items-center tw-justify-center tw-mx-auto tw-mb-4">
                                <i class="fas fa-redo tw-text-white tw-text-2xl"></i>
                            </div>
                            <h4 class="tw-font-semibold tw-text-gray-800 tw-mb-2">Revaluation</h4>
                            <p class="tw-text-gray-600 tw-text-sm">Apply for result revaluation</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const resultTypeFilter = document.getElementById('resultTypeFilter');
    const yearFilter = document.getElementById('yearFilter');
    const sortFilter = document.getElementById('sortFilter');
    const resultsContainer = document.getElementById('resultsContainer');
    const resultsCount = document.getElementById('resultsCount');
    const resultItems = document.querySelectorAll('.result-item');

    function filterResults() {
        const selectedType = resultTypeFilter.value;
        const selectedYear = yearFilter.value;
        const selectedSort = sortFilter.value;
        
        let visibleCount = 0;
        
        resultItems.forEach(item => {
            const itemType = item.dataset.type;
            const itemYear = item.dataset.year;
            
            const typeMatch = !selectedType || itemType === selectedType;
            const yearMatch = !selectedYear || itemYear === selectedYear;
            
            if (typeMatch && yearMatch) {
                item.style.display = 'block';
                visibleCount++;
            } else {
                item.style.display = 'none';
            }
        });
        
        // Update results count
        resultsCount.textContent = `${visibleCount} results found`;
        
        // Sort results
        if (selectedSort === 'date') {
            sortByDate();
        } else if (selectedSort === 'title') {
            sortByTitle();
        } else if (selectedSort === 'type') {
            sortByType();
        }
    }
    
    function sortByDate() {
        const items = Array.from(resultItems).filter(item => item.style.display !== 'none');
        items.sort((a, b) => {
            const dateA = new Date(a.querySelector('.text-muted').textContent);
            const dateB = new Date(b.querySelector('.text-muted').textContent);
            return dateB - dateA;
        });
        
        items.forEach(item => resultsContainer.appendChild(item));
    }
    
    function sortByTitle() {
        const items = Array.from(resultItems).filter(item => item.style.display !== 'none');
        items.sort((a, b) => {
            const titleA = a.querySelector('.card-title').textContent.toLowerCase();
            const titleB = b.querySelector('.card-title').textContent.toLowerCase();
            return titleA.localeCompare(titleB);
        });
        
        items.forEach(item => resultsContainer.appendChild(item));
    }
    
    function sortByType() {
        const items = Array.from(resultItems).filter(item => item.style.display !== 'none');
        items.sort((a, b) => {
            const typeA = a.dataset.type;
            const typeB = b.dataset.type;
            return typeA.localeCompare(typeB);
        });
        
        items.forEach(item => resultsContainer.appendChild(item));
    }
    
    // Add event listeners
    resultTypeFilter.addEventListener('change', filterResults);
    yearFilter.addEventListener('change', filterResults);
    sortFilter.addEventListener('change', filterResults);
    
    // Initialize filters
    filterResults();
});
</script>
{% endblock %}
